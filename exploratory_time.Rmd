---
title: "Exploratory Analyses: Time Trends"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)

library(tidyverse)
library(lubridate)
library(viridis)
library(scales)
mvc_clean <- read_csv("E:/Desktop/mvc_clean.csv", show_col_types = FALSE)
```

# Time Trends

This section focuses **exclusively on long-term temporal behavior** of NYC motor vehicle collisions.  
Unlike the Overview page, which summarized daily and hourly structure, this section highlights:

- Multi-year changes  
- Seasonal patterns  
- Rolling averages  
- Policy- and event-related structural shifts  

---

# 1. Annual Collision Trends (Long-Term Behavior)

```{r annual}
mvc_clean |>
  count(crash_year) |>
  ggplot(aes(x = crash_year, y = n)) +
  geom_line(size = 1.4, color = "#1f78b4") +
  geom_point(size = 3, color = "#084c7f") +
  scale_x_continuous(breaks = unique(mvc_clean$crash_year)) +
  labs(
    title = "Annual Collision Totals in NYC",
    x = "Year",
    y = "Number of Collisions"
  ) +
  theme_minimal(base_size = 15)
```

**Interpretation:**  
This visualization highlights **long-term structural changes** including:

- Gradual decline since Vision Zero (2014)  
- Sharp reductions in 2020–2021 during COVID mobility restrictions  
- Partial rebound afterward  

---

# 2. Monthly Seasonal Pattern (Across All Years)

```{r month-season}
mvc_clean |>
  mutate(month_label = month(crash_date, label = TRUE)) |>
  count(month_label) |>
  ggplot(aes(x = month_label, y = n, group = 1)) +
  geom_line(size = 1.2, color = "#2C93E8") +
  geom_point(size = 2, color = "#084c7f") +
  labs(
    title = "Seasonal Pattern of Collisions (Aggregated Across Years)",
    x = "Month",
    y = "Total Collisions"
  ) +
  theme_minimal(base_size = 15)
```

**Interpretation:**  
A consistent seasonal structure emerges:

- Higher collision levels in **summer and early fall**  
- Lower activity in **winter**, potentially due to reduced traffic and weather-related caution  

---

# 3. Month-Year Heatmap (Seasonality × Long-Term)

```{r heatmap-month-year}
mvc_clean |>
  mutate(
    year = crash_year,
    month = month(crash_date, label = TRUE)
  ) |>
  count(year, month) |>
  ggplot(aes(x = month, y = factor(year), fill = n)) +
  geom_tile() +
  scale_fill_viridis(option = "C") +
  labs(
    title = "Heatmap of Collisions by Month and Year",
    x = "Month",
    y = "Year",
    fill = "Collisions"
  ) +
  theme_minimal(base_size = 14)
```

**Interpretation:**  
The heatmap allows clear visualization of both:

- Strong annual seasonality  
- Structural shocks (e.g., COVID dip)  

---

# 4. 30-Day Rolling Average (Smoothing Short-Term Noise)

```{r rolling}
mvc_clean |>
  count(crash_date) |>
  arrange(crash_date) |>
  mutate(
    rolling_30 = zoo::rollmean(n, k = 30, fill = NA, align = "right")
  ) |>
  ggplot(aes(x = crash_date)) +
  geom_line(aes(y = n), alpha = 0.3, color = "#bbbbbb") +
  geom_line(aes(y = rolling_30), color = "#1f78b4", size = 1.1) +
  labs(
    title = "30-Day Rolling Average of Collision Counts",
    x = "Date",
    y = "Collisions"
  ) +
  theme_minimal(base_size = 15)
```

**Interpretation:**  
The smoothed curve reduces daily noise and emphasizes:

- Seasonal cycles  
- Extended dips (winter months, COVID lockdown)  
- Long-term decline patterns  

---

# 5. Trend vs Seasonal Decomposition (TS Decomposition)

```{r decomposition, warning=FALSE}
daily_counts <- mvc_clean |>
  count(crash_date) |>
  complete(crash_date = seq(min(crash_date), max(crash_date), by = "day"), fill = list(n = 0))

ts_data <- ts(daily_counts$n, frequency = 365)

decomp <- stl(ts_data, s.window = "periodic")

plot(decomp)
```

**Interpretation:**  
This decomposition separates the time series into:

- **Trend** — long-term structural decline  
- **Seasonal** — strong annual periodicity  
- **Remainder** — short-term irregular spikes (weather events, holidays)  

---

# Summary

Compared to the Overview page, this section emphasizes **long-term and structural temporal dynamics**, showing:

- A multi-year decrease in collision frequency  
- STRONG seasonality across months  
- COVID-driven structural breaks  
- Stable weekday effects but shifting long-term traffic patterns  
- Clear cyclical and trend components via decomposition  

These temporal insights inform the modeling phase and contextualize patterns found in spatial and contributing-factor analyses.

