---
title: "About the Data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)
library(tidyverse)
library(lubridate)
library(janitor)
library(hms)
```

# Data Source

This project uses the **Motor Vehicle Collisions – Crashes** dataset published by the  
**New York City Police Department (NYPD)** via **NYC Open Data**.

- **Link:** https://data.cityofnewyork.us/Public-Safety/Motor-Vehicle-Collisions-Crashes/h9gi-nx95  
- **Unit of observation:** Each row represents a single motor vehicle collision.  
- **Key fields include:**  
  - Date and time of crash  
  - Borough  
  - Latitude and longitude  
  - Number of persons injured or killed  
  - Contributing factors  
  - Vehicle types  

The raw dataset contains hundreds of thousands of observations and dozens of variables.  
We performed cleaning to standardize variable names, construct time variables, and remove invalid rows.

---

# Data Import

Before cleaning, the raw dataset is loaded from our `data/` directory.

```{r load-raw}
mvc_raw <- read_csv("E:/Desktop/mvc_raw.csv", show_col_types = FALSE) |>
clean_names()
mvc_raw |> glimpse()
```

---

# Data Cleaning

We performed the following cleaning steps:

1. **Standardized variable names** using `janitor::clean_names()`.  
2. **Combined crash_date and crash_time** into a single `crash_datetime` variable.  
3. Extracted **year**, **month**, **weekday**, and **hour**.  
4. Created indicators for **any injury** and **any fatality**.  
5. Removed rows with missing borough or missing geolocation.  
6. Selected a clean subset of variables relevant to our analysis.  

The cleaning code is below:

```{r cleaning}
# -----------------------------
# 1. Delete Variables
# -----------------------------

cols_to_drop <- c(
  "vehicle_type_code_3", 
  "vehicle_type_code_4",
  "vehicle_type_code_5",
  "contributing_factor_vehicle_3",
  "contributing_factor_vehicle_4",
  "contributing_factor_vehicle_5",
  "off_street_name",
  "location"
)

mvc_clean <- mvc_raw %>%
  select(-all_of(cols_to_drop))

# -----------------------------
# 2. Delete NA value
# -----------------------------
mvc_clean <- mvc_clean %>%
  
  # Latitude
  filter(!is.na(latitude),
         !is.na(longitude)) %>%
  
  # NA
  filter(!is.na(crash_date),
         !is.na(crash_time)) %>%
  
  # Injure & Killed
  filter(!is.na(number_of_persons_injured),
         !is.na(number_of_persons_killed))

# -----------------------------
# 3. Pivot time
# -----------------------------
mvc_clean <- mvc_clean %>%
  mutate(
    crash_date = mdy(crash_date),      
    crash_year = year(crash_date),
    crash_month = floor_date(crash_date, "month"),
    crash_time = as_hms(crash_time)
  )

# -----------------------------
# 4. supplement variables
# -----------------------------
mvc_clean <- mvc_clean %>%
  mutate(
    any_injury = number_of_persons_injured > 0,
    any_death  = number_of_persons_killed  > 0
  )
```

---

# Save & Reload Cleaned Data

```{r save}
write_csv(mvc_clean, "E:/Desktop/mvc_clean.csv")
```

To ensure reproducibility across pages, the cleaned dataset is reloaded:

```{r load-clean}
mvc_clean <- read_csv("E:/Desktop/mvc_clean.csv", show_col_types = FALSE)
```

---

# Summary of Cleaned Data

Below is a summary of the cleaned dataset:

```{r skim}
mvc_clean |>
  glimpse()
```

```{r count}
mvc_clean |>
  summarize(
    total_records = n(),
    total_injuries = sum(number_of_persons_injured),
    total_deaths = sum(number_of_persons_killed)
  )
```

---

# Variables Used in Analysis

The cleaned dataset includes the following fields:

- **crash_datetime** – Combined date/time of crash  
- **year, month, wday, hour** – Extracted time features  
- **borough** – Manhattan / Brooklyn / Queens / Bronx / Staten Island  
- **latitude, longitude** – Geographic coordinates  
- **number_of_persons_injured**  
- **number_of_persons_killed**  
- **any_injury** – Indicator for whether injury occurred  
- **any_death** – Indicator for whether a fatality occurred  
- **contributing_factor_\*** – NYPD-reported contributing factors  

These variables form the basis for exploratory analyses, mapping, and modeling presented in later sections.

---

# Supplement Data 

## **NYC Traffic Volume **  
- **Source:** NYC Open Data
- **Link:** https://data.cityofnewyork.us/Transportation/Automated-Traffic-Volume-Counts/7ym2-wayt/about_data
- **Description:**  
  Hourly traffic counts from NYC Department of Transportation traffic sensors.  
  These data help contextualize collision rates by describing **exposure**, i.e., periods of heavier or lighter road usage.

Examples of variables include:
- Sensor ID  
- Borough  
- Hourly vehicle counts  
- Roadway type  

This dataset is used to explore whether **higher traffic volume** corresponds to increased collision frequency.

---


# Notes

- Observations with missing borough or geolocation were removed to support spatial analysis.  
- The dataset may still contain reporting noise due to real-world police data collection.  
- Additional filtering may be applied in modeling pages depending on research needs.
